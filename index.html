<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web DJ</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #111; color: #fff; }
    #player-container, #voice-container { opacity: 0; transition: opacity 2s ease; }
    audio { display: none; }
    button { padding: 1rem; font-size: 1.2rem; margin-top: 2rem; }
  </style>
</head>
<body>
  <h1>ðŸŽ§ DJ Webpage</h1>
  <button onclick="startDJ()">Start DJ</button>

  <!-- YouTube Player -->
  <div id="player-container">
    <div id="player"></div>
  </div>

  <!-- Audio Element for Voice Clips -->
  <div id="voice-container">
    <audio id="voice" preload="auto"></audio>
  </div>

  <script>
    const voiceClips = Array.from({ length: 30 }, (_, i) =>
      `voiceclips/${i}.mp3`
    );

    let player;
    let ytReady = false;
    let voiceAudio = document.getElementById('voice');

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '0',
        width: '0',
        playerVars: {
          listType: 'playlist',
          list: 'PLD58ECddxRngHs9gZPQWOCAKwV1hTtYe4',
          autoplay: 0,
          controls: 0
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerReady(event) {
      ytReady = true;
      player.setShuffle(true);
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED) {
        fadeOut('player-container', () => {
          playRandomClip();
        });
      }
    }

    function playRandomClip() {
      const clip = voiceClips[Math.floor(Math.random() * voiceClips.length)];
      voiceAudio.src = clip;
      voiceAudio.volume = 0;
      voiceAudio.play();

      fadeIn('voice-container');
      fadeVolume(voiceAudio, 0, 1, 2000); // fade in

      voiceAudio.onended = () => {
        fadeVolume(voiceAudio, 1, 0, 2000);
        fadeOut('voice-container', () => {
          fadeIn('player-container');
          player.nextVideo(); // play next video in the playlist
        });
      };
    }

    function fadeIn(id) {
      const el = document.getElementById(id);
      el.style.opacity = 1;
    }

    function fadeOut(id, callback) {
      const el = document.getElementById(id);
      el.style.opacity = 0;
      setTimeout(callback, 2000);
    }

    function fadeVolume(audio, from, to, duration) {
      const steps = 20;
      const stepTime = duration / steps;
      let currentStep = 0;
      const interval = setInterval(() => {
        currentStep++;
        audio.volume = from + (to - from) * (currentStep / steps);
        if (currentStep >= steps) clearInterval(interval);
      }, stepTime);
    }

    function startDJ() {
      if (!ytReady) {
        alert("YouTube player not ready yet. Please wait a moment and try again.");
        return;
      }
      player.playVideo(); // start the playlist
    }

    // Load YouTube IFrame API
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);
  </script>
</body>
</html>
